
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>exp</title>
  <script src="jsPsych-6.1.0/jspsych.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-text.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
  <script src="js/jspsych-html-slider-response_required.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-external-html.js"></script>
  <script src="jsPsych-6.1.0/plugins/jspsych-html-mouse-response.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/lodash.min.js"></script>
  <script src="js/firebase.js"></script>
  <link href="jsPsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css">
  <style>
    body {
      cursor: default;
    }
    .jspsych-content-wrapper {
      width: 900px;
      height: 1200px;
    }
    .paringsImgsLeft,
    .paringsImgsRight {
      height: 320px;
      margin: 0px;
    }
    .imgInstr {
      height: 150px; 
    }
    .paringsImgsLeft {
      margin-right: 10px;
    }
    .displayInstr {
      height: 130px;
    }
  
  </style>
</head>
<body></body>
<script>

  /* Parameters for the Evaluative Conditioning part */
  var delayIti = 1000;  // inter-trial-interval for trials
  var delayTrial = 2500; // duration of each trial
  var numOfUS = 8; // number of US to be paired with each CS

  /* Parameters for the Reverse Correlation task */
  var numOfPairs = 150 * 6; 

  var genColor = function (colorID, colorName) { return "<span style='color:" + colorID + "'><b>" + colorName + "</b></span>" };

  /* Initial variables */
  var timeline = [];
  var preloadimages = [];
  var stims = [];

  var jspsych_id = jsPsych.data.getURLVariable("id");
  jspsych_id = jspsych_id == null ? jsPsych.randomization.randomID(15) : jspsych_id; // assign random id if not provided in URL
  var prolificID = jsPsych.data.getURLVariable("PROLIFIC_PID");
  if(prolificID == null) {prolificID = "999";}

  // Variable coding for the blue/yellow pairing with pleasant/unpleasant pictures
  var pairing_cond = jsPsych.data.getURLVariable("pairing_cond");
  if(pairing_cond == null) {pairing_cond = jsPsych.randomization.sampleWithoutReplacement(["placebo_blue_pos_G1B", "placebo_yellow_pos_G1B", "placebo_blue_pos_G1Y", "placebo_yellow_pos_G1Y","instruction_blue_pos_G1B", "instruction_yellow_pos_G1B", "instruction_blue_pos_G1Y", "instruction_yellow_pos_G1Y"], 1)[0];}

  /* Material */
  // US stimuli 
  var US_pos = [
  'us_posneg/uspos/1463.jpg',
  'us_posneg/uspos/1590.jpg',
  'us_posneg/uspos/5260.jpg',
  'us_posneg/uspos/5270.jpg',
  'us_posneg/uspos/7260.jpg',
  'us_posneg/uspos/7270.jpg',
  'us_posneg/uspos/7330.jpg',
  'us_posneg/uspos/8170.jpg',
  ];
  
  var US_neg = [
  'us_posneg/usneg/1275.jpg',
  'us_posneg/usneg/7380.jpg',
  'us_posneg/usneg/9181.jpg',
  'us_posneg/usneg/9280.jpg',
  'us_posneg/usneg/9290.jpg',
  'us_posneg/usneg/9373.jpg',
  'us_posneg/usneg/9405.jpg',
  'us_posneg/usneg/9830.jpg',
  ];

  // Preload all the faces with their background color (for the instruction)
  var faces = [
        "stimuli/Face19_B.png",
        "stimuli/Face28_B.png",
        "stimuli/Face55_B.png",
        "stimuli/Face95_B.png",
        "stimuli/Face104_B.png",
        "stimuli/Face115_B.png",
        "stimuli/Face119_B.png",
        "stimuli/Face142_B.png",
        "stimuli/Face10_J.png",
        "stimuli/Face16_J.png",
        "stimuli/Face17_J.png",
        "stimuli/Face45_J.png",
        "stimuli/Face85_J.png",
        "stimuli/Face103_J.png",
        "stimuli/Face116_J.png",
        "stimuli/Face132_J.png",
        "stimuli/Face19_J.png",
        "stimuli/Face28_J.png",
        "stimuli/Face55_J.png",
        "stimuli/Face95_J.png",
        "stimuli/Face104_J.png",
        "stimuli/Face115_J.png",
        "stimuli/Face119_J.png",
        "stimuli/Face142_J.png",
        "stimuli/Face10_B.png",
        "stimuli/Face16_B.png",
        "stimuli/Face17_B.png",
        "stimuli/Face45_B.png",
        "stimuli/Face85_B.png",
        "stimuli/Face103_B.png",
        "stimuli/Face116_B.png",
  ];

// Preload all the face without their background color and as a function of their group (for the EC task)
  var group1 = [
  "stimuli_CS/Face19.png", 
  "stimuli_CS/Face28.png",
  "stimuli_CS/Face55.png",
  "stimuli_CS/Face95.png",
  "stimuli_CS/Face104.png",
  "stimuli_CS/Face115.png",
  "stimuli_CS/Face119.png",
  "stimuli_CS/Face142.png"
  ];

  var group2 = [
  "stimuli_CS/Face10.png", 
  "stimuli_CS/Face16.png",
  "stimuli_CS/Face17.png",
  "stimuli_CS/Face45.png",
  "stimuli_CS/Face85.png",
  "stimuli_CS/Face103.png",
  "stimuli_CS/Face116.png",
  "stimuli_CS/Face132.png"
  ];

  // preload
  preloadimages.push(US_pos, US_neg, faces, group1, group2);

  // randomize order
  US_pos = _.shuffle(US_pos);
  US_neg = _.shuffle(US_neg);
  group1 = _.shuffle(group1);
  group2 = _.shuffle(group2);

  // Creating the two lists of stimuli (having both gp1 and gp2 faces)
  var Selection_pos_gp1 = ([group1[0],group1[1],group1[2], group1[3]]);
  var Selection_pos_gp2 = ([group2[0],group2[1],group2[2], group2[3]]);
  var Selection_neg_gp1 = ([group1[4],group1[5],group1[6], group1[7]]);
  var Selection_neg_gp2 = ([group2[4],group2[5],group2[6], group2[7]]);

  var pos_list = _.flattenDeep([Selection_pos_gp1, Selection_pos_gp2]);
  var neg_list = _.flattenDeep([Selection_neg_gp1, Selection_neg_gp2]);

  pos_list = _.shuffle(pos_list);
  neg_list = _.shuffle(neg_list);

  var CS = _.flattenDeep([pos_list, neg_list]);
  var US = _.flattenDeep([US_pos, US_neg]);

  /* Functions */
  // duplicate elements of an array n times
  // see https://stackoverflow.com/questions/56330349/how-to-duplicate-elements-in-a-js-array-without-creating-dependent-elements?
  /*
  function duplicateElements(elementsArray, times) {
    var newArray = [];
    for (let index = 0; index < elementsArray.length; index++) {
      var currentElement = elementsArray[index];
      var currentType = typeof currentElement
      for (let index = 0; index < times; index++) {
        if (currentType !== "object" && currentType) {
          newArray.push(currentElement)
        } else if (currentType === "object" && currentType) {
          newArray.push({ ...currentElement })
        }
      }
    }
    return newArray;
  }
*/
  /* RANDOMIZATION ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  /* EC PROCEDURE */

  // generate US-CS parings
  CS.map(function (e) { stims.push({ CS: e }) });
  stims.map(function (e, i) { e.US = US[i] });


  // fixed US-CS horizontal position
  var CSposition = jsPsych.randomization.sampleWithoutReplacement(["LEFT", "RIGHT"], 1)[0];

  if (CSposition == "LEFT") {
      var USposition = "RIGHT";
    } else {
      var USposition = "LEFT";
  };

  /* EXPERIMENT ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  /* Fullscreen mode & Consent */
    var activeFullscreen = {
      message: "",
      button_label: "To start the study, please switch to fullscreen",
      type: 'fullscreen',
      fullscreen_mode: true,
      delay_after: 200,
    };

    // Consent
    var check_consent = function(elem) {
      if (document.getElementById('info').checked 
        & document.getElementById('volunt').checked 
        & document.getElementById('anony').checked 
        & document.getElementById('end').checked 
        & document.getElementById('consqc').checked 
        & document.getElementById('summ').checked 
        & document.getElementById('participate').checked ) {
        return true;
      }
      else {
        alert("If you wish to participate, you must check all the boxes.");
        return false;
      }
      return false;
    };


    var consent = {
      type:'external-html',
      url: "https://marinerougier.github.io/Plac_EC/external_page_consent.html",
      cont_btn: "start",
      on_load: function() {
          $('.jspsych-content-wrapper').css({ "height": "1500px" });
    },
      check_fn: check_consent
    };

  /* General INSTRUCTIONS */
  var Instr_gene1 = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>About this study</h1>";
      html += "<p class = 'justify'>In this study, you will complete a few tasks and answer a few questions. ";
      html += "The whole study should last around <b>7 minutes</b>. Note that it is extremely important that ";
      html += "you remain <b>fully concentrated</b> during the entire study.</b></p>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };


  /* EC INSTRUCTIONS */
 var Instr_EC_1 = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>In the following task, ";
      html += "you will be presented with a series of 16 pairs of pictures. ";
      html += "More specifically, you will be presented with pictures of blurred faces and with pleasant and unpleasant pictures. ";
      html += "Pictures of faces will be presented on the "+CSposition+" of the screen whereas pleasant and unpleasant pictures will be on the "+USposition+" of the screen.<br><br>"
      html += "<p class='justify'>Your task will be to <b><u>look carefully at ";
      html += "all the pictures</u> (i.e., both pictures on the left and on the right). </b>The task will be automatically paced, <b>please remain focused.<br><br></b></p>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to start TASK 1</p>";
      return html;
    },
  };

 var Instr_EC_2_G1Y = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>Before going further, you should know that <b>the faces that were displayed in the previous task are ";
      html += "in fact divided into two distinct groups</b> of faces: Faces of the <b><span style='color:#2a57ea'><b>blue</b></span> group and faces of the <b><span style='color:#b5a21b'><b>yellow</b></span> group.<br><br> "
      html += "<center><p class='instructions'>Here are the faces of the <b><span style='color:#2a57ea'><b>blue</b></span> group:</b></p>";
      html += "<img src = 'stimuli/Face19_B.png'>";
      html += "<img src = 'stimuli/Face28_B.png'>";
      html += "<img src = 'stimuli/Face55_B.png'>";
      html += "<img src = 'stimuli/Face95_B.png'><br>";
      html += "<img src = 'stimuli/Face104_B.png'>";
      html += "<img src = 'stimuli/Face115_B.png'>";
      html += "<img src = 'stimuli/Face119_B.png'>";
      html += "<img src = 'stimuli/Face142_B.png'><br><br>";
      html += "<center><p class='instructions'>Here are the faces of the <b><span style='color:#b5a21b'><b>yellow</b></span> group:</b></p>";
      html += "<img src = 'stimuli/Face10_J.png'>";
      html += "<img src = 'stimuli/Face16_J.png'>";
      html += "<img src = 'stimuli/Face17_J.png'>";
      html += "<img src = 'stimuli/Face45_J.png'><br>";
      html += "<img src = 'stimuli/Face85_J.png'>";
      html += "<img src = 'stimuli/Face103_J.png'>";
      html += "<img src = 'stimuli/Face116_J.png'>";
      html += "<img src = 'stimuli/Face132_J.png'><br><br>";
      html += "<p class='instructions'><b>Please, take a few moments to look at the faces. </b></b>More specific instructions will follow.<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

 var Instr_EC_2_G1B = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>Before going further, you should know that <b>the faces that were displayed in the previous task are ";
      html += "in fact divided into two distinct groups</b> of faces: Faces of the <b><span style='color:#2a57ea'><b>blue</b></span> group and faces of the <b><span style='color:#b5a21b'><b>yellow</b></span> group.<br><br> "
      html += "<center><p class='instructions'>Here are the faces of the <b><span style='color:#2a57ea'><b>blue</b></span> group:</b></p>";
      html += "<img src = 'stimuli/Face10_B.png'>";
      html += "<img src = 'stimuli/Face16_B.png'>";
      html += "<img src = 'stimuli/Face17_B.png'>";
      html += "<img src = 'stimuli/Face45_B.png'><br>";
      html += "<img src = 'stimuli/Face85_B.png'>";
      html += "<img src = 'stimuli/Face103_B.png'>";
      html += "<img src = 'stimuli/Face116_B.png'>";
      html += "<img src = 'stimuli/Face132_B.png'><br><br>";
      html += "<center><p class='instructions'>Here are the faces of the <b><span style='color:#b5a21b'><b>yellow</b></span> group:</b></p>";
      html += "<img src = 'stimuli/Face19_J.png'>";
      html += "<img src = 'stimuli/Face28_J.png'>";
      html += "<img src = 'stimuli/Face55_J.png'>";
      html += "<img src = 'stimuli/Face95_J.png'><br>";
      html += "<img src = 'stimuli/Face104_J.png'>";
      html += "<img src = 'stimuli/Face115_J.png'>";
      html += "<img src = 'stimuli/Face119_J.png'>";
      html += "<img src = 'stimuli/Face142_J.png'><br><br>";
      html += "<p class='instructions'><b>Please, take a few moments to look at the faces. </b></b>More specific instructions will follow.<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };


var Instr_EC_intermediary_NoContingency = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 1</h1>";
      html += "<p class = 'justify'>In the previous series of 16 trials, <b>faces of the blue and yellow groups were both presented <u>as many times</u> with pleasant pictures as with unpleasant pictures </b>(the software randomly paired faces with pictures). However, <b>in the upcoming series of 16 trials, in TASK 2, this will change.</b> More information will follow. ";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

 var Instr_EC_placebo_UpcomingTask = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 2</h1>";
      html += "<p class = 'justify'>TASK 2 is similar to TASK 1 in the sense that ";
      html += "you will again be presented with a series of 16 pairs of pictures. ";
      html += "<b>However, <u>this time faces of one group (blue or yellow) will be consistently presented with pleasant pictures whereas the faces of the other group will be consistently presented with unpleasant pictures.</u></b></br> Information about which group is presented with which type of picture will follow after the task. <br>"
      html += "<p class='justify'>As before, your task will be to <b><u>look carefully at ";
      html += "all the pictures</u> (i.e., both pictures on the left and on the right). </b>The task will be automatically paced, <b>please remain focused.<br><br></b></p>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

 var Instr_EC_3_posBlue_placebo = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 2</h1>";
      html += "<p class = 'justify'>Before you continue the study, it is very important for you to consider the following information about the previous 16 trials: ";
      html += "<li><strong>The faces that were presented together with <b><u>pleasant images</b></u> were always those of the <span style='color:#2a57ea'><b>blue</b></span> group</strong></li>";
      html += "<li><strong>The faces that were presented together with <u><b>unpleasant images</b></u> were always those of the <b><span style='color:#b5a21b'><b>yellow</b></span>  group</strong></li>";
      html += "</ul>";
      html += "<p class = 'justify'>Please read carefully and make sure that you memorize the information above. <b>It is extremely important that you remember this information</b></b></p>";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to start Task 2</p>";
      return html;
    },
  };

 var Instr_EC_3_posYellow_placebo = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 2</h1>";
      html += "<p class = 'justify'>Before you continue the study, it is very important for you to consider the following information about the previous 16 trials: ";
      html += "<li><strong>The faces that were presented together with <b><u>unpleasant images</b></u> were always those of the <span style='color:#2a57ea'><b>blue</b></span> group</strong></li>";
      html += "<li><strong>The faces that were presented together with <u><b>pleasant images</b></u> were always those of the <b><span style='color:#b5a21b'><b>yellow</b></span>  group</strong></li>";
      html += "</ul>";
      html += "<p class = 'justify'>Please read carefully and make sure that you memorize the information above. <b>It is extremely important that you remember this information</b></b></p>";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to start Task 2</p>";
      return html;
    },
  };

var Instr_EC_instruction_UpcomingTask = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 2</h1>";
      html += "<p class = 'justify'>TASK 2 is similar to TASK 1 in the sense that ";
      html += "you will again be presented with a series of 16 pairs of pictures. ";
      html += "<b>However, <u>this time faces of one group (blue or yellow) will be consistently presented with pleasant pictures whereas the faces of the other group will be consistently presented with unpleasant pictures.</u></b></br> Information about which group is presented with which type of picture will be presented on the next screen. <br></p>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

var Instr_EC_3_posBlue_instruction = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 2</h1>";
      html += "<p class = 'justify'>Before you continue the study, it is very important for you to consider the following information about the upcoming series of 16 trials: ";
      html += "<li><strong>The faces that will be presented together with <b><u>pleasant images</b></u> will always be those of the <span style='color:#2a57ea'><b>blue</b></span> group</strong></li>";
      html += "<li><strong>The faces that will be presented together with <u><b>unpleasant images</b></u> will always be those of the <b><span style='color:#b5a21b'><b>yellow</b></span>  group</strong></li>";
      html += "</ul>";
      html += "<p class = 'justify'>Please read carefully and make sure that you memorize the information above. <b>It is extremely important that you remember this information</b></b>. Before experiencing this upcoming task <b>you will answer a few questions.</b> You will go through this task at the very end of the experiment. Therefore, read carefully and make sure that you memorize the information above.</p></b>";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

var Instr_EC_3_posYellow_instruction = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function () {
      var html = "";
      html += "<h1>TASK 2</h1>";
      html += "<p class = 'justify'>Before you continue the study, it is very important for you to consider the following information about the upcoming series of 16 trials: ";
      html += "<li><strong>The faces that will be presented together with <b><u>unpleasant images</b></u> will always be those of the <span style='color:#2a57ea'><b>blue</b></span> group</strong></li>";
      html += "<li><strong>The faces that will be presented together with <u><b>pleasant images</b></u> will always be those of the <b><span style='color:#b5a21b'><b>yellow</b></span>  group</strong></li>";
      html += "</ul>";
      html += "<p class = 'justify'>Please read carefully and make sure that you memorize the information above. <b>It is extremely important that you remember this information</b></b>. Before experiencing this upcoming task <b>you will answer a few questions.</b> You will go through this task at the very end of the experiment. Therefore, read carefully and make sure that you memorize the information above.</p></b>";
      html += "<br><br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

  // EC ---------------------------------------------------------------------------------------------------------------
  var evacond = {
    timeline_variables: stims,
    randomize_order: true,
    choices: jsPsych.NO_KEYS,
    trial_duration: delayTrial,
    post_trial_gap: delayIti,
    repetitions: 1, // total: 32 trials
    on_load: function () {
      $('.jspsych-content').css({ "max-width": "100%" });
    },
    timeline: [{
      type: 'html-keyboard-response',
      stimulus: function () {
        if (CSposition == "LEFT") {
          var leftImg = jsPsych.timelineVariable('CS', true);
          var rightImg = jsPsych.timelineVariable('US', true);
        } else {
          var leftImg = jsPsych.timelineVariable('US', true);
          var rightImg = jsPsych.timelineVariable('CS', true);
        };
        html = '';
        html += "<img class='paringsImgsLeft' src='" + leftImg + "'>";
        html += "<img class='paringsImgsRight' src='" + rightImg + "'>";
        return html;
      },
      on_finish: function (data) {
        $('.jspsych-content').css({ "max-width": "90%" });
        data.task = "evacond";
        data.CS = jsPsych.timelineVariable('CS', true);
        data.US = jsPsych.timelineVariable('US', true);
        data.CSposition = jsPsych.timelineVariable('CSposition', true);
      },
    }]
  };

  
// Questions ---------------------------------------------------------------------------------------------------------------

/* Questions INSTRUCTIONS */
  var Instr_Quest = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    on_load: function() {
          $('.jspsych-content-wrapper').css({ "width": "900px" });
          $(".jspsych-content").css("max-width", "90%");
          $('.jspsych-content-wrapper').css({ "height": "1200px" });
    },
    stimulus: function() {
      var html = "";
      html += "<p class='justify'>Now, we will ask you a few questions about TASK 2 and about yourself. ";
      html += "It is extremely important that you try to answer <b>as honestly and as spontaneously as possible.</b></br></br>";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to begin</p>";
      return html;
    },
  };

// Liking
    var likertPreamble = '<p class = "justify">Please indicate your degree of (dis)agreement with the statements listed below. ' +
        'To do so, use the following scale: ' +
        'from 1 = “Totally disagree” to 7 = “Totally agree”</p>';

    var likertScale = ["1</br>Totally disagree", "2", "3", "4", "5", "6", "7</br>Totally agree"];


    var likingGrpItems = [
        'I like the ' + genColor("#b5a21b", "yellow") + ' group.',
        'I like the ' + genColor("#2a57ea", "blue") + ' group.',
        'Please answer 4 to this statement.',
        'The ' + genColor("#b5a21b", "yellow") + ' group is positive.',
        'The ' + genColor("#2a57ea", "blue") + ' group is positive.',
    ];

    var questionsLikingGrp = [];
    likingGrpItems.map(function (item) { questionsLikingGrp.push({ prompt: '<i>' + item + '</i>', labels: likertScale, required: true }); });

    var likingGrp = {
        type: 'survey-likert',
        preamble: likertPreamble,
        questions: questionsLikingGrp,
        post_trial_gap: 300,
        on_finish: function (data) {
            $(".jspsych-content-wrapper").css("height", "1200px");
            var parsed_response = JSON.parse(data.responses);
            jsPsych.data.addProperties({
                likingYellow1: parsed_response.Q0,
                likingBlue1: parsed_response.Q1,
                AttentionCheck: parsed_response.Q2,
                likingYellow2: parsed_response.Q3,
                likingBlue2: parsed_response.Q4,
            });
        },
    };


// memory of valence - color of group for the placebo condition 
var PosNegGrpOptions_plac = ['the ' + genColor("#2a57ea", "blue") + ' group was paired with pleasant pictures and the ' + genColor("#b5a21b", "yellow") + ' group with unpleasant pictures ', 'the ' + genColor("#b5a21b", "yellow") + ' group was paired with pleasant pictures and the ' + genColor("#2a57ea", "blue") + ' group with unpleasant pictures ', 'I do not remember'];

var reportedPairing_plac = {
        type: 'survey-multi-choice',
        questions: [{ prompt: "Please report the instruction that we provided about how the two groups were paired with pleasant and unpleasant pictures in the last task (TASK 2): (if you do not remember, select the 'I do not remember' option)", options: PosNegGrpOptions_plac, required: true }],
        button_label: "continue",
        on_finish: function (data) {
            jsPsych.data.addProperties({
                reportedPairing: JSON.parse(data.responses).Q0,
            });
            console.log(data);
        },
    };

// memory of valence - color of group for the instruction condition 
var PosNegGrpOptions_instr = ['the ' + genColor("#2a57ea", "blue") + ' group will be paired with pleasant pictures and the ' + genColor("#b5a21b", "yellow") + ' group with unpleasant pictures ', 'the ' + genColor("#b5a21b", "yellow") + ' group will be paired with pleasant pictures and the ' + genColor("#2a57ea", "blue") + ' group with unpleasant pictures ', 'I do not remember'];

var reportedPairing_instr = {
        type: 'survey-multi-choice',
        questions: [{ prompt: "Please report the instruction that we provided about how the two groups will be paired with pleasant and unpleasant pictures in the upcoming task (TASK 2): (if you do not remember, select the 'I do not remember' option)", options: PosNegGrpOptions_instr, required: true }],
        button_label: "continue",
        on_finish: function (data) {
            jsPsych.data.addProperties({
                reportedPairing: JSON.parse(data.responses).Q0,
            });
            console.log(data);
        },
    };


// Believability of the contingencies

var beliefScale = [
  "1<br>Not at all accurate","2","3","4","5<br>Totally accurate"
];

// for yellowpos
var questionsBelief_yellowpos = [
  {
    prompt: "The instructions about the second series of 16 trials (TASK 2) specified that this series consists of two types of trials: (1) trials in which yellow group members are presented together with pleasant pictures and (2) trials in which blue group members are presented together with unpleasant pictures. At the time that you read this instruction, to what extent did you believe that this instruction provided an accurate description of the second series of 16 trials? It is crucial that you answer honestly.",
    labels: beliefScale,
    required: true
  }
];

var BeliefContingencies_yellowpos = {
  type: 'survey-likert',
  questions: questionsBelief_yellowpos,
  post_trial_gap: 300,
  on_finish: function (data) {
    $(".jspsych-content-wrapper").css("height", "1200px");
    var parsed_response = JSON.parse(data.responses);
    jsPsych.data.addProperties({ belief_contingencies: parsed_response.Q0 });
  }
};

//for bluepos
var questionsBelief_bluepos = [
  {
    prompt: "The instructions about the second series of 16 trials (TASK 2) specified that this series consists of two types of trials: (1) trials in which blue group members are presented together with pleasant pictures and (2) trials in which yellow group members are presented together with unpleasant pictures. At the time that you read this instruction, to what extent did you believe that this instruction provided an accurate description of the second series of 16 trials? It is crucial that you answer honestly.",
    labels: beliefScale,
    required: true
  }
];

var BeliefContingencies_bluepos = {
  type: 'survey-likert',
  questions: questionsBelief_bluepos,
  post_trial_gap: 300,
  on_finish: function (data) {
    $(".jspsych-content-wrapper").css("height", "1200px");
    var parsed_response = JSON.parse(data.responses);
    jsPsych.data.addProperties({ belief_contingencies: parsed_response.Q0 });
  }
};

// demand awareness
  var demand_awareness = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'What do you think the researchers were trying to achieve in this study?', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_finish: function (data) {
            jsPsych.data.addProperties({
                demand_awareness: JSON.parse(data.responses).Q0,
            });
        },
    };

  var influence_awareness = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Do you think that the information on the presentation of the pleasant/unpleasant pictures presented on the "+USposition+" and the blue/yellow groups of faces presented on the "+CSposition+" influenced your responses when you had to evaluate the blue and yellow groups?", options: ['Yes', 'No', 'I do not know'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              influence_awareness: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var demand_compliance = {
      type: 'survey-multi-choice',
      questions: [{prompt: "When we asked you to evaluate the blue/yellow groups, did you respond truthfully? Or did you try to fake your response (i.e., tried to tell us what you thought we wanted to hear)? Please be honest here (it will not affect payment in any way).", options: ['Yes - I faked my response based on what I thought the researchers wanted to find', 'No - my responses were based on how I genuinely felt', 'I do not know'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              demand_compliance: JSON.parse(data.responses)["Q0"],
          });
      },
  };

 /* AGE */
  var age = {
      timeline: [{
        type: 'survey-text',
        questions: [{prompt: "How old are you?", rows: 1, columns: 10}],
        button_label: "Continue",
      }],
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      loop_function: function(data){ 
        var age = data.values()[0].responses;
        var age = JSON.parse(age).Q0; 
        if(age == ""){
          alert("Please indicate your age"); 
          return true; 
        }
      },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              age: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var gender = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Please indicate your gender:", options: ['Male', 'Female', 'Other'], required: true}],
      button_label: "Continue",
      on_finish: function(data) {
          jsPsych.data.addProperties({
              gender: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var languageOptions = ['Native speaker', 'Very well', 'Well', 'Average', 'Badly', 'Very badly'];
  var language = {
        type: 'survey-multi-choice',
        questions: [{ prompt: "How well do you speak english?", options: languageOptions, required: true }],
        button_label: "continue",
        on_finish: function (data) {
            jsPsych.data.addProperties({
                language: JSON.parse(data.responses).Q0,
            });
            console.log(data);
        },
    };

  var Prolific_reported = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'Please indicate your Prolific ID:', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_finish: function (data) {
            jsPsych.data.addProperties({
                Prolific_reported: JSON.parse(data.responses).Q0,
            });
        },
    };

  var comments = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'Do you have comments regarding this study? [Optional]', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        on_finish: function (data) {
            jsPsych.data.addProperties({
                Comment: JSON.parse(data.responses).Q0,
            });
        },
    };

 /* EXIT FULLSCREEN MODE */
  var exitFullscreen = {
    type: 'fullscreen',
    fullscreen_mode: false
  };

    /* DEBRIEF */
  var debrief = [];
  debrief += "<h1>End of the study</h1>";
  debrief += "<p class='justify'>Thank you for participating in this online experiment!<br><br>";
  debrief += "In some experiments, we cannot tell people everything about the experiment at the beginning because their responses would not be ";
  debrief += "natural. For example, if we told people what the point of the experiment was ahead of time, then some people might do whatever ";
  debrief += "it is they think we want them to do, just to be helpful. Other people might do the exact opposite of what they think we want "; 
  debrief += "them to do, just to show us that we cannot figure them out. When people are trying to second-guess what the experiment is "; 
  debrief += "really about, and they behave a certain way because of it, our results get messed up. That is because they are not behaving "; 
  debrief += "like they naturally would in the real world. The whole point of this experiment is to find out how people would ";
  debrief += "naturally behave.<br><br>";
  debrief += "Now we would like to explain what we were trying to learn about with this study. At some point, we told you that we systematically "; 
  debrief += "presented pleasant vs. unpleasant pictures together with pictures of blue and yellow group members or that you would experience this in the future. This was meant to influence your evaluation of the blue and yellow group. "; 
  debrief += "For instance, you should like the blue group more than the yellow group if you were led to believe that the blue group was presented together with pleasant pictures and the yellow group with unpleasant pictures. But this should not happen if you were led to think these pairings would occur in the future. Importantly, you should know that faces of the blue and yellow group were always equally often presented with pleasant and unpleasant pictures. In this study, we wanted to target your belief (that this was the case) and not the actual pairing. <br><br>";
  debrief += "But our more specific goal here was to test whether TASK 2 could change how you evaluated blue and yellow group members. "; 
  debrief += "More specifically, if you thought that the blue group was presented together with positive pictures, you should have a more positive opinion "; 
  debrief += "of the blue group (as compared to the yellow group). <br><br>";
  debrief += "We would like to emphasize that there are no correct responses in this study: We were looking at people’s natural responses. ";
  debrief += "We hope you understand that we couldn't tell you all of this before because it would have ruined our study. ";
  debrief += "Again, your responses will be anonymous and will be analyzed as part of a group of responses.</br></br>";
  debrief += "We hope this explanation was clear. If you want additional information, if you have any questions, or if you would like ";
  debrief += "to withdraw consent and have your data excluded, do not hesitate to contact us via Prolific Academic. If you are "; 
  debrief += "interested, you can also ask for the results of this experiment—be aware, however, that this could take several weeks "; 
  debrief += "to gather all the data we need and to analyze them. <br><br>";
  debrief += "You can copy this code on Prolific: <b>7B9D5899</b> ";
  debrief += "or you can click on the following link to validate your participation:</p>";
  debrief += "<a href='https://app.prolific.com/submissions/complete?cc=7B9D5899' target='_blank'>click here</a><br><br>";


  /* TIMELINES ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  timeline.push(consent);
  timeline.push(activeFullscreen, 
                Instr_gene1,
                Instr_EC_1,
                evacond
                );

  switch(pairing_cond) {
  case "placebo_blue_pos_G1B":
    timeline.push(Instr_EC_2_G1B,
      Instr_EC_intermediary_NoContingency,
      Instr_EC_placebo_UpcomingTask,
      evacond,
                    Instr_EC_3_posBlue_placebo,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_plac,
                    BeliefContingencies_bluepos
                    );
      break;
  case "placebo_yellow_pos_G1B":
    timeline.push(Instr_EC_2_G1B,
      Instr_EC_intermediary_NoContingency,
      Instr_EC_placebo_UpcomingTask,
      evacond,
                    Instr_EC_3_posYellow_placebo,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_plac,
                    BeliefContingencies_yellowpos
                    );
    break;
  case "placebo_blue_pos_G1Y":
    timeline.push(Instr_EC_2_G1Y,
      Instr_EC_intermediary_NoContingency,
      Instr_EC_placebo_UpcomingTask,
      evacond,
                    Instr_EC_3_posBlue_placebo,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_plac,
                    BeliefContingencies_bluepos
                    );
      break;
  case "placebo_yellow_pos_G1Y":
    timeline.push(Instr_EC_2_G1Y,
      Instr_EC_intermediary_NoContingency,
      Instr_EC_placebo_UpcomingTask,
      evacond,
                    Instr_EC_3_posYellow_placebo,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_plac,
                    BeliefContingencies_yellowpos
                    );
      break;
  case "instruction_blue_pos_G1B":
    timeline.push(Instr_EC_2_G1B,
      Instr_EC_intermediary_NoContingency,
      Instr_EC_instruction_UpcomingTask,
                    Instr_EC_3_posBlue_instruction,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_instr,
                    BeliefContingencies_bluepos
                    );
      break;
  case "instruction_yellow_pos_G1B":
    timeline.push(Instr_EC_2_G1B,
      Instr_EC_intermediary_NoContingency,
      Instr_EC_instruction_UpcomingTask,
                    Instr_EC_3_posYellow_instruction,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_instr,
                    BeliefContingencies_yellowpos
                    );
    break;
  case "instruction_blue_pos_G1Y":
    timeline.push(Instr_EC_2_G1Y,
      Instr_EC_intermediary_NoContingency,
      Instr_EC_instruction_UpcomingTask,
                    Instr_EC_3_posBlue_instruction,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_instr,
                    BeliefContingencies_bluepos
                    );
      break;
  case "instruction_yellow_pos_G1Y":
    timeline.push(Instr_EC_2_G1Y,
      Instr_EC_intermediary_NoContingency,
      Instr_EC_instruction_UpcomingTask,
                    Instr_EC_3_posYellow_instruction,
                    Instr_Quest,
                    likingGrp,
                    reportedPairing_instr,
                    BeliefContingencies_yellowpos
                    );
      break;
  }
timeline.push(demand_awareness,
                    influence_awareness,
                    demand_compliance,
                    age,
                    gender,
                    language,
                    Prolific_reported,
                    comments,
                    exitFullscreen
                    );


  preloadimages = _.flattenDeep(preloadimages);

  timeline = _.flattenDeep(timeline); // do not remove this!

  /* INITIALISE EXP  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */
  jsPsych.init({
    timeline: timeline,
    preload_images: preloadimages,
    max_load_time: 500*1000,
    exclusions: {
      min_width: 1100,
      min_height: 600,
      max_width: 1600,
      max_height: 900,
    },
    on_finish: function (data) {
      $("#jspsych-content").html("<img src='https://i.gifer.com/4V0b.gif'>");


      /* Initialize Firebase */
      var config = {
        apiKey: "AIzaSyAPTEPrT8V9T1-GouWXnW6jknK3brmagJs",
        databaseURL: "https://postdocgent.firebaseio.com/"
      };

      firebase.initializeApp(config);
      var database = firebase.database();

      /* jsPsych: add data to every trial */
      jsPsych.data.addProperties({
        jspsych_id: jspsych_id,
        prolificID: prolificID,
        pairing_cond: pairing_cond,
        CSposition: CSposition,
        totalTime: jsPsych.totalTime()
      });

      var dataEC = data.filter({ task: 'evacond' }).csv();

      /* Send data to Firebase */
      database
        .ref("EC_placebo_5/" + jspsych_id + "/")
        .update({ dataEC })
        .then(function () {
              console.log("Data sent!");
              $("#jspsych-content").html(debrief);
        });
    }
  });
</script>

</html>